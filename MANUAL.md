# PC製造ダッシュボードシステム 操作マニュアル

## 1. システム概要

このシステムは、2つの主要なプログラムで構成されています。

1.  **データ処理バックエンド (`main.py`)**:
    -   生産実績データ(`KANSEI_JISSEKI.txt`)を定期的（1時間ごと）に読み込み、データベースを更新する裏方のプログラムです。
    -   常時稼働させることを想定しています。

2.  **ダッシュボードUI (`app.py`)**:
    -   バックエンドが更新したデータベースの情報を、グラフや表で可視化するWebアプリケーションです。
    -   ユーザーがデータを見たいときに起動します。

## 2. アーキテクチャ

この2つのプログラムは、`data/sqlite/production.db` というデータベースファイルを介して連携します。

```
[KANSEI_JISSEKI.txt] ----(1時間ごと)----> [main.py] ----(書き込み)----> [production.db] <----(読み込み)---- [app.py] ----> [Webブラウザ]
```

-   `main.py`は、定期的に実績データをデータベースに書き込み、データを蓄積していきます。
-   `app.py`は、その蓄積されたデータを読み込んで表示するだけです。

この設計により、データ更新処理と画面表示処理が分離され、安定した運用が可能になります。

## 3. 操作手順

### 3.1. データ処理バックエンドの実行

このプログラムは、一度起動したら、PCをシャットダウンするまで動き続ける常駐サービスです。
PC起動時などに、コマンドプロンプトやターミナルで以下のコマンドを一回だけ実行してください。

```bash
python -m src.main
```

実行すると、1時間ごとに`KANSEI_JISSEKI.txt`をチェックし、新しいデータをデータベースに登録し続けます。

### 3.2. ダッシュボードUIの表示

データをグラフや表で確認したい場合は、別のコマンドプロンプトやターミナルを立ち上げ、以下のコマンドを実行します。

```bash
python -m streamlit run src/app.py
```

実行後、ターミナルに表示されるURL（例: `http://localhost:8501`）をWebブラウザで開くと、ダッシュボードが表示されます。

### 3.3. 品目マスターの更新

`MARA_DL.csv`の内容を更新し、それをデータベースに反映させたい場合は、以下の特別なコマンドを実行します。
これにより、データベース内の品目マスター情報が最新の状態に更新されます。

**注意:** このコマンドは、バックエンドサービス(`main.py`)が動いていない状態で実行してください。

```bash
python -m src.main --sync-master
```

## 4. 本番環境への設定変更

このシステムは、開発環境と本番環境で参照するデータファイルのパスを切り替えることができます。

-   **開発環境 (デフォルト)**: `data/sample/` 内のサンプルファイルを参照します。
-   **本番環境**: `\\SAPIF01\...` から始まるネットワークパス上の実ファイルを参照します。

本番環境で運用する際は、**`APP_ENV`** という環境変数を **`production`** に設定してください。

**Windowsでの設定例:**
```bash
# コマンドプロンプトで環境変数を設定してからプログラムを実行
set APP_ENV=production
python -m src.main
```

環境変数を設定することで、プログラムは自動的に本番用のネットワークパスを参照するようになります。
